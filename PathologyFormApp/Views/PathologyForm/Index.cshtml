@model IEnumerable<PathologyFormApp.Models.PathologyRequisitionForm>

@{
    ViewData["Title"] = "Pathology Forms";
    var isDoctor = User.IsInRole("Doctor");
}

<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>Pathology Forms</h2>
        @if (!isDoctor)
        {
            <a asp-action="NurseForm" class="btn btn-primary">Create New Form</a>
        }
    </div>

    <div class="table-responsive">
        <table class="table table-striped table-hover">
            <thead>
                <tr>
                    <th>UHID</th>
                    <th>Patient Name</th>
                    <th>Lab Ref No</th>
                    <th>Status</th>
                    <th>Created By</th>
                    <th>Created At</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    <tr>
                        <td>@item.UHID</td>
                        <td>@item.Name</td>
                        <td>@item.LabRefNo</td>
                        <td>
                            <span class="badge @GetStatusBadge(item.Status)">
                                @GetStatusDisplayName(item.Status)
                            </span>
                        </td>
                        <td>@item.CreatedBy.FullName</td>
                        <td>@item.CreatedAt.ToString("g")</td>
                        <td>
                            <div class="d-flex gap-1">
                                @if (isDoctor && item.Status == FormStatus.NurseSubmitted)
                                {
                                    <a asp-action="DoctorForm" asp-route-id="@item.UHID" class="btn btn-sm btn-warning">Review</a>
                                }
                                else if (!isDoctor && item.Status == FormStatus.Draft)
                                {
                                    <a asp-action="NurseForm" asp-route-uhid="@item.UHID" class="btn btn-sm btn-primary">Edit</a>
                                }
                                <a asp-controller="Pathology" asp-action="Details" asp-route-uhid="@item.UHID" class="btn btn-sm btn-info">Details</a>
                            </div>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function() {
            // Add any additional JavaScript functionality here
        });
    </script>
}

@functions {
    public string GetStatusBadge(FormStatus status)
    {
        return status switch
        {
            FormStatus.Draft => "bg-secondary",
            FormStatus.NurseSubmitted => "bg-primary",
            FormStatus.DoctorReviewed => "bg-info",
            FormStatus.Completed => "bg-success",
            _ => "bg-light text-dark"
        };
    }

    public string GetStatusDisplayName(FormStatus status)
    {
        return status switch
        {
            FormStatus.Draft => "Draft",
            FormStatus.NurseSubmitted => "Submitted by Nurse",
            FormStatus.DoctorReviewed => "Reviewed by Doctor",
            FormStatus.Completed => "Completed",
            _ => status.ToString()
        };
    }
} 